<admin-section [sectionTitle]="'Calendar View'">
  <div class="gantt-chart">
    <div class="gantt-header">
      <h2>Lịch Hẹn</h2>
      <div class="date-picker">
        <label for="date">Chọn ngày:</label>
        <input
          type="date"
          id="date"
          [(ngModel)]="selectedDate"
          (change)="onDateChange()"
        />
      </div>
    </div>

    <div *ngIf="loading" class="loading">Đang tải dữ liệu...</div>

    <div *ngIf="!loading && staffRows.length > 0" class="gantt-container">
      <div class="time-column">
        <div class="time-header">Giờ</div>
        @for (timeSlot of timeSlots; track timeSlot) {
        <div class="time-slot">{{ timeSlot }}</div>
        }
      </div>

      @for (staff of staffRows; track staff.id) {
      <div class="booking-column">
        <div class="booking-header">{{ staff.name }}</div>
        <div class="booking-timeline">
          @for (timeSlot of timeSlots; track timeSlot) {
          <div class="timeline-slot"></div>
          } @for (booking of bookingsForStaff(staff.id); track booking.id) {
          <div
            class="booking-item"
            [ngStyle]="getBookingStyle(booking)"
            (click)="openBookingDetail(booking)"
          >
            <div class="booking-customer">{{ booking.customerName }}</div>
            <div class="booking-time">
              {{ formatTime(booking.startTime) }} -
              {{ formatTime(booking.endTime) }}
            </div>
          </div>
          }
        </div>
      </div>
      }
    </div>

    <div *ngIf="!loading && staffRows.length === 0" class="no-data">
      Không có booking nào cho ngày {{ selectedDate }}
    </div>
  </div>

  <!-- Booking Detail Modal -->
  <div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Chi tiết Booking</h3>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>

      <div class="modal-body" *ngIf="selectedBooking">
        <div class="detail-row">
          <strong>Khách hàng:</strong>
          <span>{{ selectedBooking.customerName }}</span>
        </div>

        <div class="detail-row">
          <strong>Email:</strong>
          <span>{{ selectedBooking.customerEmail }}</span>
        </div>

        <div class="detail-row">
          <strong>Nhân viên:</strong>
          <span>{{ selectedBooking.staff.name }}</span>
        </div>

        <div class="detail-row">
          <strong>Ngày:</strong>
          <span>{{ selectedBooking.bookingDate }}</span>
        </div>

        <div class="detail-row">
          <strong>Thời gian:</strong>
          <span
            >{{ formatTime(selectedBooking.startTime) }} -
            {{ formatTime(selectedBooking.endTime) }}</span
          >
        </div>

        <div class="detail-row">
          <strong>Thời lượng:</strong>
          <span>{{ selectedBooking.durationTime | duration : "string" }}</span>
        </div>

        <div class="detail-row">
          <strong>Dịch vụ:</strong>
          <span>{{ getServiceNames(selectedBooking.services) }}</span>
        </div>

        <div class="detail-row">
          <strong>Tổng tiền:</strong>
          <span>{{ selectedBooking.totalPrice | currency : "CAD" }}</span>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeModal()">Đóng</button>
      </div>
    </div>
  </div>
</admin-section>
